<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Kundvagn</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
 <h1>Din kundvagn</h1>

 <% if (success) { %>
   <div class="cart-success"><%= success %></div>
 <% } %>

 <% if (error) { %>
   <div class="cart-error"><%= error %></div>
 <% } %>

 <% if (items.length === 0) { %>
    <p class="cart-empty">Kundvagnen är tom.</p>
  <% } else { %>
    <table class="cart-table">
      <tbody>
        <% items.forEach(item => { %>
          <tr class="cart-row">
            <td class="cart-name"><%= item.name %></td>
            <td class="cart-price"><%= item.price %> kr</td>
            <td class="cart-qty"><%= item.quantity %> st</td>
            <td class="cart-actions">
              <form method="post" action="/cart/remove" class="cart-remove-form">
                <input type="hidden" name="productId" value="<%= item.id %>">
                <button type="submit" class="cart-btn cart-btn-remove">−</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <div class="cart-summary">
      <p><strong>Pris för produkter:</strong> <%= total %> kr</p>
      <p><strong>Frakt:</strong> <%= shipping %> kr</p>
      <p><strong>Summa att betala:</strong> <%= final %> kr</p>
      <p><strong>Antal varor:</strong> <%= quantity %></p>

      <form method="post" action="/cart/clear" class="cart-clear-form">
        <button type="submit" id="clear-cart" class="cart-btn cart-btn-clear">Töm kundvagn</button>
      </form>

      <form method="post" action="/cart/checkout" class="cart-checkout-form">
        <button type="submit" class="cart-btn cart-btn-checkout">Betala</button>
      </form>
    </div>
  <% } %>

  <% if (!discountSuccess) { %>
    <form method="post" action="/cart/discount" class="cart-discount-form">
      <input type="text" name="code" placeholder="Ange rabattkod" class="cart-discount-input">
      <button type="submit" class="cart-btn cart-btn-discount">Använd kod</button>
      <% if (discountCode) { %>
        <p class="cart-error">Ogiltig kod: <%= discountCode %></p>
      <% } %>
    </form>
  <% } else { %>
    <p class="cart-success">Rabattkod "<%= discountCode %>" aktiverad!</p>
  <% } %>

  <a href="/products" class="cart-link">Fortsätt handla</a>
</body>
</html>